{% extends "index.html" %}
{% block start %}
{% load humanize %}
<form method="post" action="{% url 'net_worths' %}">
  {% csrf_token %}
<div class="flex flex-col items-center justify-center">
  <!-- Main Label -->
  <div class="flex flex-col items-center w-full max-w-xs mb-4">
    <label class="form-control w-full">
      <div class="label">
        <span class="label-text">Looking for net worth?</span>
      </div>
    </label>

    <!-- Search Type Dropdown -->
    <select
      id="searchTypeDropdown"
      class="select select-primary w-full max-w-xs mb-2"
      onchange="toggleSelection()"
    >
      <option disabled selected>Search by</option>
      <option value="date">Date</option>
      <option value="note">Note</option>
    </select>

    <!-- Month and Year Selections -->
    <div id="dateSelection" class="flex space-x-4 hidden">
      <!-- Month Label and Dropdown -->
      <div class="flex flex-col items-start">
        <label class="label">
          <span class="label-text">Select Month</span>
        </label>
        <select class="select select-primary w-full max-w-xs" name="month">
          <option disabled selected>Month</option>
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>

      <!-- Year Label and Dropdown -->
      <div class="flex flex-col items-start">
        <label class="label">
          <span class="label-text">Select Year</span>
        </label>
        <select class="select select-primary w-full max-w-xs" name="year">
          <option disabled selected>Year</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
          <option value="2026">2026</option>
          <option value="2027">2027</option>
        </select>
      </div>
      <div class="flex flex-col items-start">
        <label class="label">
          <span class="label-text"></span>
        </label>
        <button type="submit" class="btn btn-primary mt-4">Search</button>
      </div>
    </div>

    <!-- Text Area for Note -->
    <div id="noteSelection" class="flex flex-col items-start hidden">
      <label class="label">
        <span class="label-text">Enter Note</span>
      </label>
      <textarea class="textarea textarea-primary w-full max-w-xs" placeholder="Enter your note here" name="note"></textarea>
      <button type="submit" class="btn btn-primary mt-4">Search</button>
    </div>
  </div>
</div>
</form>

<script>
  function toggleSelection() {
    const dropdown = document.getElementById('searchTypeDropdown');
    const dateSelection = document.getElementById('dateSelection');
    const noteSelection = document.getElementById('noteSelection');

    if (dropdown.value === 'date') {
      dateSelection.classList.remove('hidden');
      noteSelection.classList.add('hidden');
    } else if (dropdown.value === 'note') {
      noteSelection.classList.remove('hidden');
      dateSelection.classList.add('hidden');
    } else {
      dateSelection.classList.add('hidden');
      noteSelection.classList.add('hidden');
    }
  }
</script>

<div class="overflow-x-auto">
    <table class="table">
      <!-- head -->
      <thead>
        <tr>
          <th>Payday ID</th>
          <th>Date</th>
          <th>Net Worth</th>
          <th>Total Savings</th>
          <th>Total Investments</th>
          <th>Total Pension</th>
          <th>Note</th>
          <th>Delete</th>
        </tr>
      </thead>
      {% for net_worth in net_worths %}
      <tbody>
        <!-- row -->
        <tr class="hover">
          <th>
            <a href="{% url 'monthly_expenses' net_worth.payday.id %}" class="btn btn-outline">{{ net_worth.payday.id }}</a>
          </th>
          <td>{{ net_worth.date|date:"M. j, Y" }}</td>
          <td>{{ user.userpreferences.currency_symbol }} {{ net_worth.net_worth|floatformat:2|intcomma }}</td>
          <td>{{ user.userpreferences.currency_symbol }} {{ net_worth.total_savings|floatformat:2|intcomma }}</td>
          <td>{{ user.userpreferences.currency_symbol }} {{ net_worth.total_investments|floatformat:2|intcomma }}</td>
          <td>{{ user.userpreferences.currency_symbol }} {{ net_worth.total_pension|floatformat:2|intcomma }}</td>
          <td>
            {% if net_worth.note %}
              <span title="{{ net_worth.note }}">Note</span>
            {% endif %}
          </td>
          <td>
            <form action="#" method="post" onsubmit="return confirm('Are you sure you want to delete this net worth?');">
              {% csrf_token %}
              <input type="hidden" name="source" value="">
              <button type="submit" class="btn btn-error" name="net_worth_id" value="{{ net_worth.id }}">
                <i class="fas fa-trash-alt"></i>
              </button>
            </form>
          </td>
        </tr>
      </tbody>
      {% endfor %}
    </table>
  </div>

{% endblock %}
