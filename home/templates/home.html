{% extends "index.html" %}
{% block start %}

{% if payday_exists %}
{% else %}
<ul class="steps">
  <li class="step {% if steps_completed.account_created %}step-primary{% endif %}">Account created</li>
  <li class="step {% if steps_completed.add_bank %}step-primary{% endif %}">Add a Bank</li>
  <li class="step {% if steps_completed.add_broker %}step-primary{% endif %}">Add a Broker</li>
  <li class="step {% if steps_completed.add_fixed_cost %}step-primary{% endif %}">Add a Fixed Cost</li>
  <li class="step {% if steps_completed.add_investment %}step-primary{% endif %}">Add an Investment</li>
  <li class="step {% if steps_completed.add_categories %}step-primary{% endif %}">Add categories</li>
  <li class="step">Add your first payday!</li>
</ul>
{% endif %}

{% if payday_exists %}
<br>
<div class="flex justify-center space-x-10">

    <div class="stats shadow">
      <div class="stat">
        <div class="stat-title">Net Worth</div>
        <div class="stat-value">{{ user.userpreferences.currency_symbol }} {{ last_net_worth.net_worth }}</div>
        <div class="stat-desc">{{ last_net_worth.perc_diff_with_last_month }}% compared to last month</div>
      </div>
    </div>

    <div class="stats shadow">
        <div class="stat">
          <div class="stat-title">Investments</div>
          <div class="stat-value">{{ user.userpreferences.currency_symbol }} {{ total_investments }}</div>
          <div class="stat-desc">{{ last_net_worth.perc_diff_investments }}% compared to last month</div>
        </div>
      </div>

      <div class="stats shadow">
        <div class="stat">
          <div class="stat-title">Pension</div>
          <div class="stat-value">{{ user.userpreferences.currency_symbol }} {{ total_pensions }}</div>
          <div class="stat-desc">{{ last_net_worth.perc_diff_pensions }}% compared to last month</div>
        </div>
      </div>

      <div class="stats shadow">
        <div class="stat">
          <div class="stat-title">PAC</div>
          <div class="stat-value">{{ user.userpreferences.currency_symbol }} {{ pac.amount }}</div>
          <div class="stat-desc"></div>
        </div>
      </div>
</div>  

{% else %}
<br>
<form id="first_time_buttons" method="POST" action="{% url 'first_time_buttons' %}"> <!-- To be removed -->
  <div class="flex flex-col items-center justify-center">
    <div class="flex flex-col items-center w-full max-w-xs mb-4">
      {% csrf_token %}

      {% if not steps_completed.add_bank %}
      <a href="{% url 'banks' %}" class="btn btn-primary w-full h-12 mb-2">Add a Bank</a><br>
      {% endif %}

      {% if not steps_completed.add_broker %}
      <a href="{% url 'brokers' %}" class="btn btn-primary w-full h-12 mb-2">Add a Broker</a><br>
      {% endif %}

      {% if not steps_completed.add_fixed_cost %}
          <a href="{% url 'fixed_costs' %}" class="btn btn-primary w-full h-12 mb-2">Add a Fixed Cost</a><br>
      {% endif %}

      {% if not steps_completed.add_investment %}
          <a href="{% url 'investments' %}" class="btn btn-primary w-full h-12 mb-2">Add an Investment</a><br>
      {% endif %}

      {% if not steps_completed.add_categories %}
          <a href="{% url 'categories' %}" class="btn btn-primary w-full h-12 mb-2">Add Categories</a><br>
      {% endif %}
    </div>
  </div>
</form>

{% endif %}
  
<h1>Net Worth Over Time</h1>
    <canvas id="netWorthChart" width="800" height="400"></canvas> <!-- Chart Canvas -->

<script>
  // Get the data passed from Django
  const graphData = JSON.parse(document.getElementById('graph-data').textContent);
  
  // Extract data for the chart
  const labels = graphData.dates;  // X-axis (dates)
  const dataValues = graphData.net_worth_values;  // Y-axis (net worth values)

  // Create the chart
  const ctx = document.getElementById('netWorthChart').getContext('2d');
  const netWorthChart = new Chart(ctx, {
      type: 'line', // Line chart
      data: {
          labels: labels,
          datasets: [{
              label: 'Net Worth (£)',
              data: dataValues,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderWidth: 2,
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  display: true,
                  position: 'top',
              },
          },
          scales: {
              x: {
                  title: {
                      display: true,
                      text: 'Date',
                  },
              },
              y: {
                  title: {
                      display: true,
                      text: 'Net Worth (£)',
                  },
                  beginAtZero: true,
              },
          },
      }
  });
</script>

{% endblock %}